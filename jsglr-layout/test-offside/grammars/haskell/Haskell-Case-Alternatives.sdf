module Haskell-Case-Alternatives
exports
  context-free syntax
    Pat "->" Exp MaybeWhere 	-> Alt   {cons("Alt")}

    Pat Gdpat+ MaybeWhere	 	-> Alt   {cons("GdAlt")}
    "|" Exp "->" Exp                  -> Gdpat {cons("GdPat")}

  context-free syntax
  	NoOffsideAltBlock -> AltList {cons("AltList")}
  	OffsideAltList   -> AltList {cons("AltList")}
  	
    "{" NoOffsideAltList "}"  -> NoOffsideAltBlock {bracket, ignore-block}
    
  context-free priorities
    Alt -> NoOffsideAlt
  >
    NoOffsideAlt ";" -> NoOffsideAlt {prefer}
  >
    ";" NoOffsideAlt -> NoOffsideAlt

  context-free syntax
    NoOffsideAlt -> NoOffsideAltList
    NoOffsideAlt ";" NoOffsideAltList -> NoOffsideAltList {cons("AltSeq")}


  context-free priorities
    Alt -> OffsideAlt {layout(gt(col(left(1)), col(first(1))))}
  >
    OffsideAlt ";" -> OffsideAlt {prefer,layout(gt(col(first(2)), col(first(1))))}
  >
    ";" OffsideAlt -> OffsideAlt {layout(gt(col(first(2)), col(first(1))))}
  >
    Alt ";" OffsideAlt -> OffsideAlt
          {cons("AltSeq"),
           layout(and(gt(col(left(1)), col(first(1))),
                  and(gt(col(first(2)), col(first(1))),
                      gt(col(first(3)), col(first(1))))))}
  
  context-free syntax
    OffsideAlt -> OffsideAltList
    OffsideAltNEWLINE OffsideAltList -> OffsideAltList {cons("AltSeq"), layout(eq(col(first(1)), col(first(2))))}

    OffsideAlt LAYOUT? -> OffsideAltNEWLINE {enforce-newline}
