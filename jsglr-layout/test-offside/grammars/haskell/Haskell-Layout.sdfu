module Haskell-Layout
exports
  lexical syntax
    WhiteChar                     -> LAYOUT
    Comment                       -> LAYOUT
    NComment                      -> LAYOUT
    

    [\ \t\n\r]                      -> WhiteChar
    UnicodeWhitespace				-> WhiteChar

    ~u[\n\r] -> AnyNoSymbol
    Symbol -> AnyNoSymbol {reject}
    "--" [\-]* -> Dashes

	~u[\n\r]* -> AnyWithSymbolList {longest-match}
    Dashes (AnyNoSymbol AnyWithSymbolList)? ([\r\n] | EOF)    -> Comment
    -> EOF

    "{-" NCommentContent* "-}" -> NComment
    NCommentText -> NCommentContent
    NComment -> NCommentContent
    L-Char+ -> NCommentText {longest-match}

    ~u[\-\{]                      -> L-Char
    Hyphen                        -> L-Char
    CurlyOpen                     -> L-Char
    [\-]                          -> Hyphen
    [\{]	                  -> CurlyOpen
    
    [\r\n] -> Newline
    LAYOUT -> NoNewlineLayout
    Newline -> NoNewlineLayout {reject}
    
    NoNewlineLayout? Newline -> NewLineLayout
    NoNewlineLayout? Newline LAYOUT -> NewLineLayout
    
  lexical restrictions
  	Dashes -/- [\-]
    Hyphen    -/- [\}]
    CurlyOpen -/- [\-]
    EOF -/- ~[]
    EOF -/- [\7]
    NewLineLayout -/- [\r\n\t\ ]
    NCommentText -/- ~[\-\{] | [\-].~[\}] | [\{].~[\-]
    NCommentText -/- [\7]

  context-free restrictions
    LAYOUT? -/- [\ \t\n\r] | [\{].[\-] | [\-].[\-]
  