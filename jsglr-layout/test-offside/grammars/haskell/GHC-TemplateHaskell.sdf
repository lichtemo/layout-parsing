module GHC-TemplateHaskell
imports Haskell-Identifier-Sorts

imports Haskell-Strings

exports
  context-free syntax
    Splice       -> Exp       {cons("SpliceExp"), avoid}
    Splice       -> Type      {cons("SpliceType"), avoid}
    Splice       -> Decl      {cons("SpliceDecl"), avoid}
    ExpSplice    -> Splice    
    "$(" Exp ")" -> ExpSplice {cons("ExpSplice")}
    VarSpliceID  -> Splice    {cons("VarSplice")}

  lexical syntax
    "$" Var -> VarSpliceID 

  lexical restrictions
    DollarSign -/- [\40]

  context-free syntax
    "[|" Exp "|]"       -> Exp     {cons("ExpQuotation")}
    "[d|" Topdecl+ "|]" -> TopDecl {cons("TopdeclQuotation")}
    "[t|" Type "|]"     -> Type    {cons("TypeQuotation")}
    "[p|" Pat "|]"      -> Pat     {cons("PatQuotation")}

  context-free syntax
    NameQuotation -> Exp {cons("NameQuotation")}

  syntax
    <"'"-LEX> <Qvar-CF> | <Qcon-CF>     -> <NameQuotation-CF> 
    <"''"-LEX> <Tyvar-CF> | <Gtycon-CF> -> <NameQuotation-CF> 
    <"'"-LEX> CharChar <"'"-LEX>        -> <NameQuotation-CF> {reject}

  syntax
    "[" <VARID-LEX> "|" <QuasiQuoteString-LEX> "|]" -> <QuasiQuote-CF> {cons("QuasiQuote"), ignore-layout}

  context-free syntax
    QuasiQuote -> Exp 

  lexical syntax
    QuasiQuoteChar*                                                                                                                                                                                                                                                                   -> QuasiQuoteString 
    ( [\0-\6] | [\8-\123] | [\125-\127] | ( [\7] ( [\0] [\128-\255] ) | ( [\1-\254] [\0-\255] ) | ( [\255] [\0-\255] ) ) | ( [\7] ( [\216-\220] [\0-\255] [\220-\255] [\0-\255] ) | ( [\219-\223] [\0-\255] [\0-\223] [\0-\253] ) | ( [\221-\222] [\0-\255] [\0-\255] [\0-\255] ) ) ) -> QuasiQuoteChar   
    "|"                                                                                                                                                                                                                                                                               -> QuasiQuotePipe   
    QuasiQuotePipe                                                                                                                                                                                                                                                                    -> QuasiQuoteChar   

  lexical restrictions
    QuasiQuotePipe -/- [\93]