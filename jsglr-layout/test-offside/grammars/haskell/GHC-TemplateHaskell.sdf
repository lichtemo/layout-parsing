module GHC-TemplateHaskell
imports Haskell-Identifier-Sorts

imports Haskell-Strings

exports
  context-free syntax
    Splice       -> Exp       {cons("SpliceExp"), avoid}
    Splice       -> Type      {cons("SpliceType"), avoid}
    Splice       -> Decl      {cons("SpliceDecl"), avoid}
    ExpSplice    -> Splice    
    "$(" Exp ")" -> ExpSplice {cons("ExpSplice")}
    VarSpliceID  -> Splice    {cons("VarSplice")}

  syntax
    <"$"-LEX> <Var-CF> -> <VarSpliceID-CF> 

  lexical restrictions
    DollarSign -/- [\40]
    DollarSign -/- ( ( [\95] | [\97-\122] ) )

  context-free syntax
    "[|" Exp "|]"       -> Exp     {cons("ExpQuotation")}
    "[d|" Topdecl+ "|]" -> TopDecl {cons("TopdeclQuotation")}
    "[t|" Type "|]"     -> Type    {cons("TypeQuotation")}
    "[p|" Pat "|]"      -> Pat     {cons("PatQuotation")}

  context-free syntax
    NameQuotation -> Exp {cons("NameQuotation")}

  syntax
    <"'"-LEX> ( <Qvar-CF> | <Qcon-CF> )     -> <NameQuotation-CF> 
    <"''"-LEX> ( <Tyvar-CF> | <Gtycon-CF> ) -> <NameQuotation-CF> 
    <"'"-LEX> CharChar <"'"-LEX>            -> <NameQuotation-CF> {reject}

  syntax
    "[" <VARID-LEX> "|" <QuasiQuoteString-LEX> "|]" -> <QuasiQuote-CF> {cons("QuasiQuote"), ignore-layout}

  context-free syntax
    QuasiQuote -> Exp 

  lexical syntax
    QuasiQuoteChar*                                                                                                                                                                                                                                                                                                                                                                                                -> QuasiQuoteString {longest-match}
    ( ( ( [\0-\6] | [\8-\123] | [\125-\127] ) | ( [\7] ( [\0] [\128-\255] ) | ( [\1-\255] [\0-\255] ) ) | ( [\7] ( [\216] [\0] [\220-\254] [\0-\255] ) | ( [\216] [\0] [\255] [\0-\255] ) | ( [\216] [\1-\255] [\0-\255] [\0-\255] ) | ( [\217-\218] [\0-\255] [\0-\255] [\0-\255] ) | ( [\219] [\0-\254] [\0-\255] [\0-\255] ) | ( [\219] [\255] [\0-\222] [\0-\255] ) | ( [\219] [\255] [\223] [\0-\253] ) ) ) ) -> QuasiQuoteChar   
    "|"                                                                                                                                                                                                                                                                                                                                                                                                            -> QuasiQuotePipe   
    QuasiQuotePipe                                                                                                                                                                                                                                                                                                                                                                                                 -> QuasiQuoteChar   

  lexical restrictions
    QuasiQuotePipe -/- [\93]