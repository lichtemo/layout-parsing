module Haskell-Statements
exports
  context-free syntax
    "do" StmtList 	    -> Exp 	{cons("Do")}
    Pat "<-" Exp 	-> Stmt 	{cons("BindStmt")}
    Exp               	-> Stmt 	{cons("ExpStmt")}
    "let" Declbinds   	-> Stmt 	{cons("LetStmt")}
    Qvar "=" Exp 	-> Fbind	{cons("FBind")}

  context-free syntax
  	NoOffsideStmtBlock -> StmtList {cons("StmtList")}
  	OffsideStmtList   -> StmtList {cons("StmtList")}
  	
    "{" NoOffsideStmtList "}"  -> NoOffsideStmtBlock {bracket, ignore-indent}

  context-free priorities
    Stmt -> NoOffsideStmtList
  >
    NoOffsideStmtList ";" -> NoOffsideStmtList
  >
    ";" NoOffsideStmtList -> NoOffsideStmtList
  > 
    Stmt ";" NoOffsideStmtList -> NoOffsideStmtList {cons("StmtSeq")}


  context-free priorities
    Stmt -> OffsideStmt {layout(gt(col(left(1)), col(first(1))))}
  >
    OffsideStmt ";" -> OffsideStmt {layout(gt(col(first(2)), col(first(1))))}
  >
    ";" OffsideStmt -> OffsideStmt {layout(gt(col(first(2)), col(first(1))))}
  >
    Stmt ";" OffsideStmt -> OffsideStmt
          {cons("StmtSeq"),
           layout(and(gt(col(left(1)), col(first(1))),
                  and(gt(col(first(2)), col(first(1))),
                      gt(col(first(3)), col(first(1))))))}
  > {
    OffsideStmt -> OffsideStmtList
    OffsideStmtNEWLINE OffsideStmtList -> OffsideStmtList {cons("StmtSeq"), layout(eq(col(first(1)), col(first(2))))}
    }

  context-free syntax
    "" -> NEWLINE
    OffsideStmt NEWLINE -> OffsideStmtNEWLINE {ast("<1>")}
